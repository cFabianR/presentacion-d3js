<!doctype html>
<html>

<head>
  <meta charset="utf-8">

  <title>D3.js y React, trabajando juntos</title>

  <meta name="description" content="Presentación para la charla 'D3.js y React, trabajando juntos'">
  <meta name="author" content="Javier Calzado">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/fjcalzado.css" id="theme">

  <!-- Theme used for syntax highlighting of code -->
  <link rel="stylesheet" href="lib/css/zenburn.css">

  <!-- Printing and PDF exports -->
  <script>
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  </script>

  <!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
</head>

<body>

  <div class="reveal">
    <div class="slides">

      <!-- Slide de Apertura -->
      <section>

        <object type="image/svg+xml" data="media/osc_logo.svg" height="120">Open South Code Logo</object>
        <h1 class="space-up-down">
          React y D3.js, trabajando juntos
        </h1>
        <div class="pulse-glow">
            <a class="bottom" href="https://fjcalzado.surge.sh">fjcalzado.surge.sh</a>
        </div>

        <!-- Notas -->
        <aside class="notes">
          Notas Aqui:
        </aside>

      </section>

      <!-- GRUPO Resumen Contenido -->
      <section>

        <!-- SLIDE de Introducción -->
        <section>
          <object class="fragment" data-fragment-index="1" data-autoslide="2000"
            type="image/svg+xml" data="media/react_logo.svg" height="180">React Logo</object>
          <svg class="fragment pulse-size" data-fragment-index="3" style="margin: 0 50px"
            height="160" viewbox="0 0 16 16">
            <path d="m417.59 527.35c-.653-.644-1.555-.965-2.707-.965-.319 0-.644.056-.976.167-.332.112-.64.262-.926.452-.285.189-.531.367-.737.533-.206.166-.401.343-.586.529-.185-.187-.381-.363-.586-.529-.206-.166-.451-.344-.737-.533-.285-.189-.594-.34-.926-.452-.332-.112-.657-.167-.976-.167-1.152 0-2.054.322-2.707.965-.653.644-.98 1.536-.98 2.678 0 .348.06.706.181 1.074.121.369.258.683.413.942.154.259.329.513.524.759.195.247.338.416.428.51.09.093.161.161.212.202l4.813 4.687c.093.094.206.14.339.14.134 0 .247-.047.339-.14l4.805-4.672c1.178-1.189 1.766-2.356 1.766-3.504 0-1.142-.327-2.035-.98-2.678" fill="#f11" transform="translate(-403.7-524.37)"/>
          </svg>
          <object class="fragment" data-fragment-index="2" data-autoslide="2000"
            type="image/svg+xml" data="media/d3_logo.svg" height="180">React Logo</object>

          <!-- Notas -->
          <aside class="notes">
              Notas Aqui:
          </aside>
        </section>

        <!-- SLIDE de Contenido -->
        <section>
          <h2>Contenido</h2>
          <ul>
            <li class="fragment"><a href="https://reactjs.org/">React</a></li>
            <li class="fragment"><a href="https://d3js.org/">D3.js</a></li>
            <li class="fragment">Problemática React + D3.js</li>
            <li class="fragment">Soluciones y ejemplos</li>
          </ul>

          <!-- Notas -->
          <aside class="notes">
              Notas Aqui:
          </aside>
        </section>

      </section>

      <!-- GRUPO React -->
      <section>

        <!-- SLIDE React Intro -->
        <section>
          <div class="flex-row center">
            <object type="image/svg+xml" data="media/react_logo.svg" height="75">React Logo</object>
            <h2 class="header-in-row">React</h2>
          </div>
          <ul>
            <li class="fragment">Construcción de Interfaces de Usuario</li>
            <li class="fragment">Componentes reusables</li>
            <li class="fragment">Declarativo, nos abstrae de modificar el DOM</li>
            <li class="fragment"><i>DOM Virtual</i></li>
          </ul>

          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>Librería tremendamente popular que nos permite construir interfaces de usuario.</li>
              <li>Basado en componentes: pequeños elementos funcionales (un botón, un input, etc) que gracias a la composición forman componentes más complejos.</li>
              <li>Declarativo, le decimos QUE queremos representar pero no COMO hacerlo, no hay que especificar cómo cambiar el DOM, React se encarga de eso por nosotros, nos abstrae de esa tarea.</li>
              <li>Una de sus claves de éxito (inmutabilidad, one way, etc), la que nos interesa, es el manejo eficiente del DOM que realiza gracias al DOM VIRTUAL. Mutaciones eficientes en el DOM Real.</li>
            </ul>
          </aside>
        </section>

        <!-- SLIDE DOM Real vs DOM Virtual -->
        <section>
          <div class="flex-row spaced">
            <div>
              <h3>DOM Real</h3>
              <ul>
                <li class="fragment">Navegador</li>
                <li class="fragment">Pesado</li>
                <li class="fragment">Cambios Costosos</li>
              </ul>
            </div>
            <div>
              <h3>DOM Virtual</h3>
              <ul>
                <li class="fragment">En Memoria</li>
                <li class="fragment">Ligero</li>
                <li class="fragment">Cambios Baratos</li>
              </ul>
            </div>
          </div>

          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>El DOM real esta ligado al navegador, es el documento que representa la página o aplicación que vemos en nuestro navegador.</li>
              <li>Es una entidad pesada, con una API grande a su alrededor</li>
              <li>Las actualizaciones del DOM son operaciones costosas para el navegador. Por tanto, mutar el DOM cada vez que el usuario interactúa con la UI puede ser ineficiente.</li>
              <li>En cambio el DOM virtual es una representación en memoria del DOM real.</li>
              <li>Es una entidad ligera y rápida</li>
              <li>Y los cambio son por tanto mucho más baratos</li>
            </ul>
          </aside>
        </section>

        <!-- SLIDE Reconciliación -->
        <section>
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            viewBox="0 0 960 560.5" style="enable-background:new 0 0 960 560.5;" xml:space="preserve">
            <style type="text/css">
              .st0{display:none;}
              .st1{display:inline;fill:#20232A;}
              .st2{fill:#FCFCFD;}
              .st3{fill:#4F5565;}
              .st4{fill:#FFFFFF;}
              .st5{fill:#333842;}
              .st6{fill:#00D4EC;}
              .st7{fill:none;stroke:#FF55F7;stroke-width:5;stroke-miterlimit:10;}
              .st8{fill:none;stroke:#00D4EC;stroke-width:5;stroke-miterlimit:10;}
              .st9{fill:#FF55F7;stroke:#FF55F7;stroke-width:3;stroke-miterlimit:10;}
              .st10{fill:#00D4EC;stroke:#00D4EC;stroke-width:3;stroke-miterlimit:10;}
              .st11{font-family:'Montserrat';}
              .st12{font-size:32px;}
              .st13{fill:#7F7F7F;stroke:#7F7F7F;stroke-width:3;stroke-miterlimit:10;}
              .st14{fill:#7F7F7F;stroke:#7F7F7F;stroke-width:5;stroke-miterlimit:10;}
              .st15{font-size:38px;}
              .st16{fill:#00ECCC;}
              .st17{opacity:0.4;}
              .st18{fill:none;stroke:#FFFFFF;stroke-width:3;stroke-miterlimit:10;}
              .st19{fill:none;stroke:#FFFFFF;stroke-width:3;stroke-miterlimit:10;stroke-dasharray:11.8286,11.8286;}
            </style>
            <g id="UI">
              <g>
                <path class="st2" d="M17.8,211.2v174.7c0,4.7,3.8,8.5,8.5,8.5h237.1c4.7,0,8.5-3.8,8.5-8.5V211.2H17.8z"/>
                <path class="st3" d="M271.8,181.7c0-4.7-3.8-8.5-8.5-8.5H26.4c-4.7,0-8.5,3.8-8.5,8.5v29.2h254L271.8,181.7L271.8,181.7z"/>
                <circle class="st4" cx="43" cy="192.2" r="6.2"/>
                <circle class="st4" cx="63.6" cy="192.2" r="6.2"/>
                <circle class="st4" cx="84.1" cy="192.2" r="6.2"/>
                <path class="st5" d="M227.9,186h-113c-3.3,0-6.2,2.8-6.2,6.2c0,3.3,2.8,6.2,6.2,6.2h113.2c3.3,0,6.2-2.8,6.2-6.2
                  C234.1,188.8,231.2,186,227.9,186z"/>
                <rect x="44.7" y="234.7" class="st6" width="65.5" height="135.8"/>
                <rect x="127.5" y="291.4" class="st6" width="117.5" height="79.3"/>
                <rect x="127.5" y="234.7" class="st6" width="117.5" height="37"/>
              </g>
            </g>
            <g id="DOM_Virtual">
              <g class="fragment" data-fragment-index="1">
                <line class="st7" x1="528.4" y1="280.3" x2="577.2" y2="352"/>
                <circle class="st9" cx="575.9" cy="353.6" r="23.9"/>
              </g>
              <text transform="matrix(1 0 0 1 384.8565 108.3565)" class="st4 st11 st12">DOM Virtual</text>
              <line class="st8" x1="480.5" y1="205.6" x2="430.7" y2="278.9"/>
              <line class="st8" x1="430.7" y1="278.9" x2="372.7" y2="353.8"/>
              <line class="st8" x1="430.7" y1="278.9" x2="478.5" y2="353.8"/>
              <line class="st8" x1="480.5" y1="205.6" x2="529.4" y2="277.4"/>
              <circle class="st10" cx="480.5" cy="205.6" r="23.9"/>
              <circle class="st10" cx="528" cy="278.9" r="23.9"/>
              <circle class="st10" cx="430.7" cy="278.9" r="23.9"/>
              <circle class="st10" cx="478.5" cy="353.8" r="23.9"/>
              <circle class="st10" cx="372.7" cy="353.8" r="23.9"/>
            </g>
            <g id="DOM_Real">
              <g class="fragment" data-fragment-index="3">
                <circle class="st9" cx="906.4" cy="352.8" r="23.9"/>
                <line class="st7" x1="858.9" y1="279.5" x2="907.7" y2="351.3"/>
              </g>
              <text transform="matrix(1 0 0 1 728.8565 108.3565)" class="st4 st11 st12">DOM Real</text>
              <circle class="st13" cx="811" cy="204.8" r="23.9"/>
              <circle class="st13" cx="858.5" cy="278.2" r="23.9"/>
              <circle class="st13" cx="761.2" cy="278.2" r="23.9"/>
              <circle class="st13" cx="809" cy="353" r="23.9"/>
              <circle class="st13" cx="703.2" cy="353" r="23.9"/>
              <line class="st14" x1="811" y1="204.8" x2="761.2" y2="278.2"/>
              <line class="st14" x1="761.2" y1="278.2" x2="703.2" y2="353"/>
              <line class="st14" x1="761.2" y1="278.2" x2="809" y2="353"/>
              <line class="st14" x1="811" y1="204.8" x2="859.9" y2="276.6"/>
            </g>
            <g id="Reconciliación">
              <text class="fragment st4 st11 st15" data-fragment-index="2" transform="matrix(1 0 0 1 476.0545 538.8836)">RECONCILIACIÓN</text>
              <g class="fragment" data-fragment-index="4">
                <path class="st16" d="M695.5,481.4l-0.1-17.2c-0.1-7.6-6.3-13.8-13.8-13.9l-19-0.2c-7.6-0.1-13.7,6-13.7,13.6l10.8,0.2
                  c1.1-2.2,3.7-3.5,6.4-3.4l12.1,0.2c3.8,0.1,6.9,3.2,6.9,7l0.1,10.3c0,3.8-3,6.8-6.8,6.8l-12.1-0.1c-2.6,0-5.4-1.5-6.6-3.6
                  l-10.6-0.1c0,7.6,6.2,13.8,13.8,13.9l18.9,0.2C689.4,495.1,695.5,489,695.5,481.4z"/>
                <path class="st16" d="M626.1,480.5c-1.2,2.1-4,3.5-6.6,3.5l-11.3-0.1c-3.9,0-7-3.2-7-7.1l-0.1-10.5c0-3.9,3.1-7,7-6.9l11.3,0.1
                  c2.7,0,5.4,1.4,6.6,3.7l11,0.1c-0.1-7.7-6.4-14.1-14.1-14.2l-18.3-0.2c-7.7-0.1-14,6.1-13.9,13.9l0.1,17.5
                  c0.1,7.7,6.4,14.1,14.1,14.2l18.3,0.2c7.7,0.1,14-6.1,13.9-13.8L626.1,480.5z"/>
                <path class="st16" d="M622.5,472c0,2.6,2.1,4.7,4.7,4.8l31.5,0.1c2.6,0,4.8-2.1,4.8-4.7c0-2.6-2.1-4.7-4.7-4.7l-31.5-0.1
                  C624.7,467.3,622.5,469.4,622.5,472z"/>
              </g>
              <g>
                <g class="st17">
                  <line class="st18" x1="643" y1="439.9" x2="643" y2="433.9"/>
                  <line class="st19" x1="643" y1="422" x2="643" y2="25.8"/>
                  <line class="st18" x1="643" y1="19.9" x2="643" y2="13.9"/>
                </g>
              </g>
            </g>
          </svg>

          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>Todos los cambios que generan nuestros componentes react, ya sea por interacción del usuario o cambios de estado, van a parar al DOM Virtual</li>
              <li>Los cambios se aglutinan en el DOM virtual, se consolidan allí ya que es rápido y barato. Pero no promocionan diréctamente al DOM real.</li>
              <li>Es React quien determina cuando se debe actualizar el DOM Real y en un proceso llamado <b>reconciliación</b>, un algoritmo DIFF evalúa la diferencia entre ambos árboles y determina cuando y qué debe modificarse</li>
              <li>Gracias a la reconciliación, los cambios se propagan al DOM real de manera eficiente, ya que se hacen en 'batch', con el mínimo número de operaciones posible.</li>
              <li>Este proceso de reconciliación, por tanto, sirve como mecanismo de sincronización entre ambos mundos.</li>
              <li>En RESUMEN: <b>React gestiona los cambios en el DOM y lo mantiene actualizado por nosotros de forma eficiente</b></li>
            </ul>
          </aside>
        </section>
      </section>

      <!-- GRUPO D3.js -->
      <section>

        <!-- SLIDE D3.js Intro -->
        <section>
          <div class="flex-row center">
            <object type="image/svg+xml" data="media/d3_logo.svg" height="75">D3.js Logo</object>
            <h2 class="header-in-row">D3.js</h2>
          </div>
          <ul>
            <li class="fragment">Visualización de datos</li>
            <li class="fragment">API de bajo nivel. Potencia. Flexibilidad.</li>
            <li class="fragment">Declarativo, nos abstrae de modificar el DOM</li>
            <li class="fragment"><i>Data Joins</i>, uniones entre datos y elementos</li>
            <li class="fragment">Tiempo real, animaciones, interactividad</li>
          </ul>

          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>D3.js es un framework, o librería, para la visualización interactiva de datos. Data-Drive-Documents. Al igual que React, es tremendamente popular y se ha convertido en la referencia de facto en este terreno.</li>
              <li>Está conformado por una API de bajo nivel lo que lo hace tremendamente potente y flexible. Es el secreto de su éxito. No es una librería de gráficos pre-hechos, enlatados. Aqui hay que picar, en cambio el límite es la creatividad de cada uno.</li>
              <li>También es declarativo, nos abstrae del DOM. El se encargará de los cambios pertinentes, nosotros le indicamos QUE queremos representar. ¿Nos suena, verdad?</li>
              <li>El mecanismo principal de D3, su core, son las uniones de datos o DATA JOINS. Nos permite establecer literalmente vinculos entre los datos que queremos representar y los elementos gráficos que van a representarlos.</li>
              <li>Al estar datos y elementos vinculado, la visualización no tiene porque ser estática sino que puede responder a los cambios en los datos. Además, admite animaciones, interactividad, etc.</li>
            </ul>
          </aside>
        </section>

        <!-- SLIDE Data Joins -->
        <section>
          <h2><i>Data Joins</i></h2>
          <div class="flex-row spaced">
            Primer Gráfico. Tabla con fila resaltada en verde (nueva). Flecha. Circulo en color.
          </div>
          <div class="flex-row spaced">
            Segundo Gráfico. Tabla con fila resaltad en rojo (dato eliminado). Flecha. Cirulo sin relleno solo trazo punteado (eliminado, ausente).
          </div>
          <div class="flex-row spaced">
            Tercer Gráfico. Tabla con fila resaltada en azul (datos actualizados). Flecha. Circulo en color cambiado y más grande (tamaño cambia).
          </div>

          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>Vamos a hacer un ejercicio mental muy sencillo para entender rápidamente las uniones de datos.</li>
              <li>Imaginemos que tenemos una tabla de paises con datos como por ejemplo, número de habitantes, renta per cápita, esperanza de vida, etc.</li>
              <li>Si quisieramos representar estos datos gráficamente, lo primero que pensaríamos sería: por cada fila, es decir por cada pais, voy a pintar un círculo por ejemplo.</li>
              <li>El tamaño de ese círculo vendrá dado por el número de habitantes. El color, por el continente al que pertenece.</li>
              <li>Finalmente su posición vendrá dada por su riqueza, los paises más ricos hacia la derecha, los más saludables (esperanza de vida) hacia arriba.</li>
              <li>COROLARIO: Hemos asociado cada fila de la tabla, cada pais, a un círculo (que es el elemento que va a representarlo en el gráfico). Y hemos dado forma, color y posición a ese círculo según los datos.</li>
              <li>Esta es la forma en la que se trabaja en D3.js.</li>
            </ul>
          </aside>
        </section>

        <!-- SLIDE Selecciones -->
        <section>
          <h2>Selecciones</h2>
            <pre><code class="code-area js" data-trim data-noescape>
              const paises = [...];
              const circulos = chart.selectAll("circle")
                  .data(paises)
                  .enter()
                  .append("circle")
                    .attr("cx", pais => xScale(pais.poderAdquisitivo))
                    .attr("cy", pais => yScale(pais.esperanzaVida))
                    .attr("r", pais => areaScale(pais.habitantes))
                    .attr("fill", pais => color(pais.continente));
            </code></pre>
            <div>
              AQUI PODRIAMOS PONER GRAFICO BOSTOCK DATA JOIN
            </div>

          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>¿Cómo se expresan o aplican las uniones de datos en código? Mediantes las selecciones. El core de D3.js incorpora funcionalidad para seleccionar elementos del DOM, muy al estilo de JQuery.</li>
              <li>En primer lugar, seleccionamos todos los elementos de tipo círculo. D3 es compatible con los selectores de css que conocemos.</li>
              <li>A continuación establecemos el data join, vinculamos los datos a nuestros elementos seleccionados. Se hace con el método data(). Los datos siempre serán un array, cada item del array se vincula a un elemento mediante una función de mapeo que por defecto es el índice.</li>
              <li>Por último operamos sobre el sub-grupo que nos interesa, enter, exit o update. En nuestro caso, añadimos (append) un elemento círculo por cada pais.</li>
              <li>A la selección establecida vamos aplicando las propiedades para darle una posición, tamaño y color en función de los datos del pais.</li>
              <li>COROLARIO: (gráfico bostock) D3 cuenta con un potente mecanismo, los data joins, que en el fondo sirven como algoritmo diff mediante el cual mutar el DOM de forma más eficiente, ¿nos suena verdad?</li>
            </ul>
          </aside>
        </section>

        <!-- SLIDE Sample -->
        <section>
          <h4>Riqueza por Paises</h4>
          <iframe style="background-color: white" data-src="https://fjcalzado.github.io/DemoSeries-D3JS-Bubble-Chart/" width="100%" height="600"></iframe>
          <a href="https://fjcalzado.github.io/DemoSeries-D3JS-Bubble-Chart/">Github</a>
          <!-- Notas -->
          <aside class="notes">
            <ul>
              <li>¿Cómo se expresan o aplican las uniones de datos en código? Mediantes las selecciones. El core de D3.js incorpora funcionalidad para seleccionar elementos del DOM, muy al estilo de JQuery.</li>
            </ul>
          </aside>
        </section>

      </section>






      <section>
        <h2>Dynamic Child Components</h2>
        <ul>
          <li class="fragment visible" data-fragment-index="0">Unique 'key' to each child component rendered</li>
          <li class="fragment visible" data-fragment-index="1">More efficient rendering</li>
          <li class="fragment visible" data-fragment-index="2">Similar to D3's data joins</li>
        </ul>
        <small class="fragment visible current-fragment" data-fragment-index="3">
          <a target="_blank" href="https://facebook.github.io/react/docs/reconciliation.html">Reconciliation - React Docs</a>
        </small>
      </section>

      <section>
        <p>Probando un link externo en iframe</p>
        <a data-preview-link="true" href="https://fjcalzado.github.io/DemoSeries-D3JS-Bubble-Chart/">Link</a>
      </section>

      <section data-background-iframe="https://fjcalzado.github.io/DemoSeries-D3JS-Bubble-Chart/">
        <h4>iFrame en background</h4>
      </section>

      <section data-background-color="#fff" data-background="https://media.giphy.com/media/lueaDWxOz0LNS/giphy.gif">
        <h2>... pelea asegurada!</h2>
      </section>

      <section>Slide 6</section>

      <section>Slide 7</section>
    </div>
  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>

  <script>
    // Detect master and extract master key via URL 'k' parameter.
    const master = Boolean(Reveal.getQueryHash().k);
    const masterKey = master ? Reveal.getQueryHash().k : null;

    Reveal.initialize({

      controls: true,
      controlsTutorial: true,
      progress: true,
      history: true, // Interesting while develop. Keeps url history.
      center: true,
      maxScale: 4.0,
      viewDistance: 3,  // Lazy loading distance in slides. Number of slides ahead to load content and media.

      transition: 'slide', // none/fade/slide/convex/concave/zoom

      multiplex: {
        secret: masterKey, // null or key, depending if client or master is connected.
        id: 'a45de79095c017f5', // id, obtained from socket.io server
        url: 'https://reveal-multiplex-fjcalzado.herokuapp.com/' // Location of socket.io server
      },

      dependencies: [
        { src: 'https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.slim.js', async: true },
        { src: master ? 'plugin/multiplex/master.js' : 'plugin/multiplex/client.js', async: true }, // Add proper multiplex script (master vs client) as dependency.
        { src: 'lib/js/classList.js', condition: function () { return !document.body.classList; } },
        { src: 'plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
        { src: 'plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
        { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
        { src: 'plugin/search/search.js', async: true },
        { src: 'plugin/zoom-js/zoom.js', async: true },
        { src: master ? 'plugin/notes/notes.js' : '', async: true } // Enable notes only for master.
      ]
    });
  </script>
</body>

</html>
